<!DOCTYPE html>
<head>
    <title>Facturapeute - La tarification 590 facile</title>
</head>
<body>
    <h1>Facture</h1>
    <form>
        <h2>Document</h2>
        <label for="identification">Identification</label>
        <input type="text" id="identification" disabled required>
        <h2>Auteur de la facture</h2>
        <label for="author-last-name">Nom</label>
        <input type="text" id="author-last-name" required><br>
        <label for="author-first-name">Prénom</label>
        <input type="text" id="author-first-name" required><br>
        <label for="author-rcc-number">N° RCC</label>
        <input type="text" id="author-rcc-number" required><br>
        <label for="author-street">N° et rue</label>
        <input type="text" id="author-street" required><br>
        <label for="author-npa">NPA</label>
        <input type="text" id="author-npa" required><br>
        <label for="author-city">Localité</label>
        <input type="text" id="author-city" required>
        <h2>Fournisseur de prestation</h2>
        <label for="service-performer-last-name">Nom</label>
        <input type="text" id="service-performer-last-name" required><br>
        <label for="service-performer-first-name">Prénom</label>
        <input type="text" id="service-performer-first-name" required><br>
        <label for="service-performer-rcc-number">N° RCC</label>
        <input type="text" id="service-performer-rcc-number" required><br>
        <label for="service-performer-street">N° et rue</label>
        <input type="text" id="service-performer-street" required><br>
        <label for="service-performer-npa">NPA</label>
        <input type="text" id="service-performer-npa" required><br>
        <label for="service-performer-city">Localité</label>
        <input type="text" id="service-performer-city" required>
        <h2>Patient/client</h2>
        <label for="customer-last-name">Nom</label>
        <input type="text" id="customer-last-name" required><br>
        <label for="customer-first-name">Prénom</label>
        <input type="text" id="customer-first-name" required><br>
        <label for="customer-street">N° et rue</label>
        <input type="text" id="customer-street" required><br>
        <label for="customer-npa">NPA</label>
        <input type="text" id="customer-npa" required><br>
        <label for="customer-city">Localité</label>
        <input type="text" id="customer-city" required><br>
        <label for="customer-birthdate">Date de naissance</label>
        <input type="date" id="customer-birthdate" required><br>
        <label for="customer-law">Loi</label>
        <select id="customer-law" disabled required>
            <option value="customer-law-lca" selected>LCA</option>
        </select><br>
        <label for="customer-refund-type">Type de remboursement</label>
        <select id="customer-refund-type" disabled required>
            <option value="customer-refund-type-tg" selected>Tiers Garant</option>
        </select><br>
        <label for="receipt-date">Date de facture</label>
        <input type="date" id="receipt-date" disabled required><br>
        <label for="receipt-number">N° de facture</label>
        <input type="number" id="receipt-number" disabled required>
        <h2>Thérapie</h2>
        <label for="therapy-type">Thérapie</label>
        <select id="therapy-type">
            <option value="therapy-type-private" selected>Thérapie individuelle</option>
            <option value="therapy-type-group">Thérapie de groupe</option>
        </select><br>
        <h2>Prestations</h2>
        <table id="service-table">
            <tr>
                <th>Date</th>
                <th>Tarif</th>
                <th>Code tarifaire</th>
                <th>Quantité</th>
                <th>Prix</th>
                <th>TVA</th>
                <th>Montant</th>
            </tr>
        </table>
        <label for="service-date">Date</label>
        <input type="date" id="service-date" required>
        <label for="service-rate-type">Tarif</label>
        <select id="service-rate-type">
            <option value="service-rate-type-590" selected>590</option>
            <option value="service-rate-type-999">999</option>
        </select>
        <label for="service-code">Code tarifaire</label>
        <select id="service-code">
            <option value="service-code-1003">1003 Acupressure, par période de 5 minutes</option>
            <option value="service-code-1004">1004 Acuponcture, par période de 5 minutes</option>
        </select>
        <label for="service-quantity">Quantité</label>
        <input type="number" id="service-quantity" value="0" onchange=updateAmount(1) required>
        <label for="service-price">Prix</label>
        <input type="text" id="service-price" value="0.00" onchange=updateAmount(1) required>
        <label for="service-tax">TVA</label>
        <input type="text" id="service-tax" value="0.00%" disabled required>
        <label for="service-amount">Montant</label>
        <input type="text" id="service-amount" value="0.00" disabled required>
        <button onclick=addService()>Ajouter la prestation</button><br>
        <label for="total-amount">Montant dû</label>
        <input type="text" id="total-amount" value="0.00" disabled required><br>
        <label for="paiement-period">Délai de paiement (jours, net)</label>
        <input type="number" id="paiement-period" value="30" required><br>
        <input type="submit" value="Générer la facture">
    </form>
</body>

<script>
    const services = [];

    window.addEventListener('load', () => {
        const date = new Date();        
        const timestamp = date.getTime();
        const fullDateString = getFullDateString(date);
        const dateInputString = getDateInputString(date);
        
        document.getElementById('identification').value = `${timestamp} ${fullDateString}`;
        document.getElementById('receipt-date').value = dateInputString;
        document.getElementById('receipt-number').value = timestamp;
    });

    getFullDateString = (date) => {
        const day = `0${date.getDate()}`.slice(-2);
        const month = `0${date.getMonth()}`.slice(-2);
        const hours = `0${date.getHours()}`.slice(-2);
        const minutes = `0${date.getMinutes()}`.slice(-2);
        const seconds = `0${date.getSeconds()}`.slice(-2);

        return `${day}.${month}.${date.getFullYear()} ${hours}:${minutes}:${seconds}`;
    };

    getDateInputString = (date) => {
        const day = `0${date.getDate()}`.slice(-2);
        const month = `0${date.getMonth()}`.slice(-2);

        return `${date.getFullYear()}-${month}-${day}`;
    };

    updateAmount = (serviceId) => {
        document.getElementById(`service-amount`).value =
            document.getElementById(`service-quantity`).value * document.getElementById(`service-price`).value;
    };

    getTotalAmount = () => {
        let totalAmount = 0;

        services.forEach(service => {
            totalAmount += service.price * service.quantity;
        });

        return totalAmount;
    };

    addService = () => {
        event.preventDefault();

        const newService = {
            date: document.getElementById('service-date').value,
            rateType: document.getElementById('service-rate-type').value,
            code: document.getElementById('service-code').value,
            quantity: document.getElementById('service-quantity').value,
            price: document.getElementById('service-price').value,
            tax: document.getElementById('service-tax').value
        };

        const newRow = document.getElementById('service-table').insertRow(-1);
        newRow.insertCell(-1).innerHTML = newService.date;
        newRow.insertCell(-1).innerHTML = newService.rateType;
        newRow.insertCell(-1).innerHTML = newService.code;
        newRow.insertCell(-1).innerHTML = newService.quantity;
        newRow.insertCell(-1).innerHTML = newService.price;
        newRow.insertCell(-1).innerHTML = newService.tax;
        newRow.insertCell(-1).innerHTML = newService.price * newService.quantity;

        services.push(newService);
    };
</script>