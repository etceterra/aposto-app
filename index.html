<!DOCTYPE html>

<head>
  <title>Facturapeute - La tarification 590 facile</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css" />
  <link rel="stylesheet" href="index.css" />
  <link rel="icon" type="image/png" href="https://terrapeute.ch/img/favicon.png" />
</head>

<body>
  <main class="container">
    <h1>Facture</h1>
    <form class="form-horizontal" onsubmit=submitInvoice(event)>
      <h2>Informations générales</h2>
      <div class="columns">
        <div class="column col-6 col-sm-12 author-col">
          <div class="card">
            <div class="card-header">
              <div class="card-title h5">
                Auteur de la facture
              </div>
            </div>
            <div class="card-body">
              <span id="author-name-display"></span>
              <div class="author-form">
                <div class="form-group">
                  <label class="form-label" for="author-name">Nom ou entreprise</label>
                  <input class="form-input" type="text" id="author-name" name="author-name" bind="author.name"
                    onblur="loadGLNNumber('author')" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="author-street">Rue et n°</label>
                  <input class="form-input" type="text" id="author-street" name="author-street" bind="author.street"
                    required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="author-zip">NPA</label>
                  <input class="form-input" type="text" id="author-zip" name="author-zip" bind="author.ZIP"
                    onblur="loadGLNNumber('author')" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="author-city">Localité</label>
                  <input class="form-input" type="text" id="author-city" name="author-city" bind="author.city"
                    onblur="loadGLNNumber('author')" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="author-email">Email</label>
                  <input class="form-input" type="text" id="author-email" name="author-email" bind="author.email"
                    required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="author-phone">Téléphone</label>
                  <input class="form-input" type="text" id="author-phone" name="author-phone" bind="author.phone"
                    required />
                </div>
                <hr>
                <div class="form-group">
                  <label class="form-label" for="author-rcc-number">N°RCC</label>
                  <input class="form-input" type="text" id="author-rcc-number" name="author-rcc-number"
                    bind="author.RCCNumber" onblur="loadGLNNumber('author')" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="author-gln-number">N°GLN</label>
                  <input class="form-input" type="text" id="author-gln-number" name="author-gln-number"
                    bind="author.GLNNumber" required />
                  <p class="form-input-hint-primary">
                    <a href="https://www.refdata.ch/fr/partenaires/requete/base-de-donnees-des-partenaires-gln"
                      target="_blank">
                      Trouver son n°GLN ou faire la demande
                    </a>
                  </p>
                  <p class="form-input-hint-success" hidden>Nous avons trouvé votre n°GLN.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="column col-6 col-sm-12 therapist-col">
          <div class="card">
            <div class="card-header">
              <div class="card-title h5">
                Thérapeute
              </div>
            </div>
            <div class="card-body">
              <span id="therapist-name-display"></span>
              <div class="therapist-form">
                <div class="form-group">
                  <label class="form-label" for="therapist-first-name">Prénom</label>
                  <input class="form-input" type="text" id="therapist-first-name" name="therapist-first-name"
                    bind="therapist.firstName" onblur="loadGLNNumber('therapist')" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="therapist-last-name">Nom</label>
                  <input class="form-input" type="text" id="therapist-last-name" name="therapist-last-name"
                    bind="therapist.lastName" onblur="loadGLNNumber('therapist')" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="therapist-street">Rue et n°</label>
                  <input class="form-input" type="text" id="therapist-street" name="therapist-street"
                    bind="therapist.street" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="therapist-zip">NPA</label>
                  <input class="form-input" type="text" id="therapist-zip" name="therapist-zip" bind="therapist.ZIP"
                    onblur="loadGLNNumber('therapist')" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="therapist-city">Localité</label>
                  <input class="form-input" type="text" id="therapist-city" name="therapist-city" bind="therapist.city"
                    onblur="loadGLNNumber('therapist')" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="therapist-email">Email</label>
                  <input class="form-input" type="text" id="therapist-email" name="therapist-email"
                    bind="therapist.email" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="therapist-phone">Téléphone</label>
                  <input class="form-input" type="text" id="therapist-phone" name="therapist-phone"
                    bind="therapist.phone" required />
                </div>
                <hr>
                <div class="form-group">
                  <label class="form-label" for="therapist-rcc-number">N°RCC</label>
                  <input class="form-input" type="text" id="therapist-rcc-number" name="therapist-rcc-number"
                    bind="therapist.RCCNumber" required />
                </div>
                <div class="form-group">
                  <label class="form-label" for="therapist-gln-number">N°GLN</label>
                  <input class="form-input" type="text" id="therapist-gln-number" name="therapist-gln-number"
                    bind="therapist.GLNNumber" required />
                  <p class="form-input-hint-primary">
                    <a href="https://www.refdata.ch/fr/partenaires/requete/base-de-donnees-des-partenaires-gln"
                      target="_blank">
                      Trouver son n°GLN ou faire la demande
                    </a>
                  </p>
                  <p class="form-input-hint-success" hidden>Nous avons trouvé votre n°GLN.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <button type="button" class="btn btn-sm btn-primary btn-edit-info" onclick="editInfo(event)" hidden>
        Modifier les informations
      </button>
      <h2>Informations du patient</h2>
      <div class="patients-list-container" hidden>
        <h5>Mes patients</h5>
        <div class="patients-list">
          <button type="button" class="btn btn-sm btn-patient" onclick=emptyPatientInfo(event)>
            <i class="icon icon-plus"></i>
            Nouveau patient
          </button>
        </div>
      </div>
      <input type="text" id="patient-id" name="patient-id" bind="patient._id" required hidden />
      <div class="form-group">
        <div class="col-6 col-sm-12">
          <label class="form-label" for="patient-first-name">Prénom</label>
          <input class="form-input" type="text" id="patient-first-name" name="patient-first-name"
            bind="patient.firstName" required />
        </div>
        <div class="col-6 col-sm-12">
          <label class="form-label" for="patient-last-name">Nom</label>
          <input class="form-input" type="text" id="patient-last-name" name="patient-last-name" bind="patient.lastName"
            required />
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" for="patient-street">Rue et n°</label>
        <input class="form-input" type="text" id="patient-street" name="patient-street" bind="patient.street"
          required />
      </div>
      <div class="form-group">
        <div class="col-3 col-sm-12">
          <label class="form-label" for="patient-zip">NPA</label>
          <input class="form-input" type="text" id="patient-zip" name="patient-zip" bind="patient.ZIP" required />
        </div>
        <div class="col-6 col-sm-12">
          <label class="form-label" for="patient-city">Localité</label>
          <input class="form-input" type="text" id="patient-city" name="patient-city" bind="patient.city" required />
        </div>
        <div class="col-3 col-sm-12">
          <label class="form-label" for="patient-canton">Canton</label>
          <select class="form-select" type="text" id="patient-canton" name="patient-canton" bind="patient.canton"
            required>
            <option value="" selected></option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <div class="col-6 col-sm-12">
          <label class="form-label" for="patient-birthdate">Date de naissance</label>
          <input class="form-input" type="date" id="patient-birthdate" name="patient-birthdate"
            bind="patient.birthdate | toDateInput" required />
        </div>
        <div class="col-6 col-sm-12">
          <label class="form-label" for="patient-gender">Sexe</label>
          <select class="form-select" id="patient-gender" name="patient-gender" bind="patient.gender" required>
            <option value="" selected></option>
            <option value="male">Homme</option>
            <option value="female">Femme</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" for="patient-email">Email</label>
        <input class="form-input" type="text" id="patient-email" name="patient-email" bind="patient.email" required />
      </div>

      <h2>Description de la séance</h2>
      <div class="form-group">
        <div class="col-2 col-sm-5">
          <label class="form-label" for="service-price">Tarif horaire</label>
        </div>
        <div class="col-3 col-sm-5">
          <input class="form-input" type="number" id="service-price" name="service-price" min="0" max="200"
            onkeyup="onPriceEdit()" bind="servicePrice.servicePrice" data-amount required />
        </div>
        <div class="col-2 currency-col">
          <label class="form-label">CHF</label>
        </div>
      </div>
      <div class="form-group">
        <div class="col-3 col-sm-12 date-col">
          <input class="form-input" type="date" id="service-date-1" name="service-date-1" required />
        </div>
        <div class="col-6 col-sm-12">
          <select class="form-select" id="service-code-1" name="service-code-1" required> </select>
        </div>
        <div class="col-3 col-sm-12 duration-col">
          <input class="form-input" type="number" id="service-duration-1" name="service-duration-1"
            placeholder="Durée (minutes)" step="5" min="0" data-amount required />
        </div>
      </div>
      <div class="form-group">
        <div class="col-3 col-sm-12 date-col">
          <input class="form-input" type="date" id="service-date-2" name="service-date-2" required />
        </div>
        <div class="col-6 col-sm-12">
          <select class="form-select" id="service-code-2" name="service-code-2"
            onchange="onServiceCodeSelected(event, 2)">
            <option value="" selected></option>
          </select>
        </div>
        <div class="col-3 col-sm-12 duration-col">
          <input class="form-input" type="number" id="service-duration-2" name="service-duration-2"
            placeholder="Durée (minutes)" step="5" min="0" data-amount />
        </div>
      </div>
      <div class="form-group">
        <div class="col-3 col-sm-12 date-col">
          <input class="form-input" type="date" id="service-date-3" name="service-date-3" required />
        </div>
        <div class="col-6 col-sm-12">
          <select class="form-select" id="service-code-3" name="service-code-3"
            onchange="onServiceCodeSelected(event, 3)">
            <option value="" selected></option>
          </select>
        </div>
        <div class="col-3 col-sm-12 duration-col">
          <input class="form-input" type="number" id="service-duration-3" name="service-duration-3"
            placeholder="Durée (minutes)" step="5" min="0" data-amount />
        </div>
      </div>
      <div class="form-group">
        <div class="col-3 col-sm-12 date-col">
          <input class="form-input" type="date" id="service-date-4" name="service-date-4" required />
        </div>
        <div class="col-6 col-sm-12">
          <select class="form-select" id="service-code-4" name="service-code-4"
            onchange="onServiceCodeSelected(event, 4)">
            <option value="" selected></option>
          </select>
        </div>
        <div class="col-3 col-sm-12 duration-col">
          <input class="form-input" type="number" id="service-duration-4" name="service-duration-4"
            placeholder="Durée (minutes)" step="5" min="0" data-amount />
        </div>
      </div>
      <div class="form-group">
        <div class="col-3 col-sm-12 date-col">
          <input class="form-input" type="date" id="service-date-5" name="service-date-5" required />
        </div>
        <div class="col-6 col-sm-12">
          <select class="form-select" id="service-code-5" name="service-code-5"
            onchange="onServiceCodeSelected(event, 5)">
            <option value="" selected></option>
          </select>
        </div>
        <div class="col-3 col-sm-12 duration-col">
          <input class="form-input" type="number" id="service-duration-5" name="service-duration-5"
            placeholder="Durée (minutes)" step="5" min="0" data-amount />
        </div>
      </div>
      <div class="form-group">
        <label class="form-label"> Total : <span id="total-amount">0.0</span> CHF </label>
      </div>
      <div class="success-alert bg-success" id="success-alert-download" hidden>
        Votre facture a été générée. Vous pouvez la télécharger ou l'imprimer.
      </div>
      <div class="success-alert bg-success" id="success-alert-email" hidden>
        Votre facture a été envoyée par mail à votre client et vous. Si vous ne la trouvez pas, vérifiez votre
        dossier Spam.
      </div>
      <div class="success-alert bg-error" id="error-alert-email" hidden>
        L'envoi par mail a échoué. Assurez-vous d'avoir téléchargé cette facture avant de générer une nouvelle facture.
      </div>
      <div class="form-group buttons-group">
        <div class="col-4 col-sm-12">
          <button type="submit" class="btn btn-primary" title="Técharger la facture en format PDF"
            onclick="submitAction=downloadInvoice">
            Télécharger la facture
          </button>
        </div>
        <div class="col-4 col-sm-12">
          <button type="submit" class="btn" title="Envoyer la facture au client, vous recevrez aussi une copie"
            onclick="submitAction=sendInvoice">
            Envoyer la facture au client
          </button>
        </div>
        <div class="col-4 col-sm-12">
          <a class="btn" title="Entamer une nouvelle facture" href="">Préparer une nouvelle facture</a>
        </div>
      </div>
    </form>
  </main>

  <template id="service-template">
    <option value="{{ service.value }}">
      {{ service.value }} —
      {{ service.label }}
    </option>
  </template>
</body>

<script src="js/utils.js"></script>
<script src="index.js"></script>
